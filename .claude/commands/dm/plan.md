---
description: 制定结构化方案，强制检索 Graveyard 防止重蹈覆辙，等待开发者选择后生成 Spec
---

进入 **PLAN 模式**（方案规划）。

## 前置操作

```sh
echo "plan" > .devmind/current-mode.txt
```

## 执行步骤

### 步骤1：强制检索 Graveyard

读取 `.devmind/memory/graveyard/` 下的所有文件。

检查当前提议是否与已否决方案相似（关键词重叠）。

可选：使用 `devmind check-graveyard "<提议描述>"` 快速检测。

如发现匹配，**必须**先输出警告：

```
⚠️ 发现相似的已否决方案：[方案名]
   否决原因：[原因摘要]
   关键词重叠：[关键词列表]

请选择：
(1) 查看完整否决原因后决定是否继续
(2) 情况不同，当前方案与此无关，继续规划
(3) 确实相似，直接放弃此方向
```

等待开发者选择后继续。

### 步骤2：输出结构化方案对比

每个方案使用以下格式：

```markdown
## 方案 X：[方案名]

### 确定的部分
- [条目]

### 不确定的部分
- ⚠️ [不确定点]：[说明]

### 风险评估
- 技术风险：低/中/高
- 回滚成本：低/中/高
```

### 步骤3：等待开发者选择

输出所有方案后，等待开发者明确选择，不要自行推进。

### 步骤4：生成 Spec 化 current-plan.md

开发者选定方案后，写入 `.devmind/current-plan.md`：

```markdown
# 计划：[任务名称]

> 选定日期：YYYY-MM-DD  方案：[方案名]

## Spec

### 约束（不可违反，违反时自动暂停）
- [约束条目]

### 预期产出（可验证）
- [ ] [可验证的产出条目]

### 允许修改的文件范围
- [文件或目录]

### 明确排除（修改这些文件时必须暂停确认）
- [文件或目录]

## 执行步骤

1. [步骤]
```

## 注意

- 不修改任何业务代码（Hook 强制执行）
- 方案对比要客观，不要偏向复杂方案
