进入 **AUTO 模式**（全自动流水线）。

## 前置操作

```sh
echo "build" > .devmind/current-mode.txt
```

## 模式说明

AUTO 模式将 explore → plan → build 串联为一条流水线，**低风险改动全程自动，高风险改动暂停确认**。

适用场景：
- 需求明确、改动范围可预期的新功能
- Bug 修复
- 小型重构

不适用场景：
- 架构级改动（使用 `/dm:plan` 手动规划）
- 不确定改动范围的探索性任务（使用 `/dm:explore` 先分析）

---

## 执行流程

### 阶段 0：启动准备

1. 读取 `.devmind/memory/index.md` 加载记忆索引
2. 检索 `.devmind/memory/graveyard/` 是否有与当前需求相似的否决方案
   - 若有匹配，**输出警告并暂停**，等待确认后继续
3. 读取当前需求（用户输入的一句话）

### 阶段 1：Explore（自动执行，不等待确认）

快速探索与需求相关的代码区域：
- 定位涉及的文件和模块
- 理解现有实现逻辑
- 评估改动影响范围

输出探索摘要（3-5 条关键发现），然后**直接进入阶段 2**，无需确认。

### 阶段 2：Plan + 风险评估（门控节点）

生成执行方案，然后自动进行风险评估：

**低风险条件（全部满足时自动推进）：**
- 涉及文件 ≤ 5 个
- 不新增 npm/pip/go 依赖
- 不修改 hook 脚本、配置文件 schema
- 不涉及数据库 migration 或破坏性 API 变更
- 改动类型为：新增文件、修改局部函数、增加配置项

**触发暂停的条件（任一满足时暂停等待确认）：**
- 涉及文件 > 5 个
- 需要新增依赖
- 需要修改核心基础设施文件（hooks、auth、数据库）
- 改动影响多个模块的公共接口
- 存在不确定的技术方案需要选择

暂停时输出：
```
AUTO 模式门控：检测到中/高风险改动，需要确认后继续。

风险原因：[具体原因]
计划改动：
  - [文件1]：[改动描述]
  - [文件2]：[改动描述]

输入任意内容继续，或输入 "stop" 取消。
```

低风险时直接输出：
```
AUTO 模式：风险评估通过（低风险），自动推进...
涉及文件：[N] 个 | 无新依赖 | 改动类型：[类型]
```

### 阶段 3：生成 Spec 并写入 current-plan.md

将方案写入 `.devmind/current-plan.md`，格式遵循标准 Spec 结构（约束、预期产出、允许范围、明确排除、执行步骤）。

写入后**直接进入阶段 4**，无需确认。

### 阶段 4：Build（自动执行）

按执行步骤逐步实现，每完成一步向 `.devmind/session.yaml` 写入检查点。

遇到以下情况**立即暂停**：
- 需要修改"明确排除"列表中的文件
- 发现预期外的依赖或副作用
- 编译/类型检查报错且无明确修复方向
- 需要做非预期的架构决策

### 阶段 5：验证与收尾

1. 运行项目的验证命令（lint、类型检查、测试——根据项目类型自动判断）
2. 输出完成摘要：
   ```
   AUTO 完成

   需求：[原始需求]
   改动文件：[列表]
   验证结果：[通过/失败]

   建议：使用 /dm:remember 沉淀本次决策
   ```

---

## 注意事项

- AUTO 模式下 Hook 仍然生效：explore/plan 阶段 Write/Edit 调用仍会被拦截
- 阶段 1-2 期间模式为 `explore`，阶段 3-4 期间模式为 `build`
- 任何阶段的暂停都可以通过回复继续，或输入 `/dm:build` 从断点续传
