## 决策：模式可见性的实现方案

- 标签：mode-display, ux, prompt-engineering
- 日期：2026-03-01

**摘要**：通过在 CLAUDE.md 中添加提示词指令，让 AI 在每次回复末尾显示当前模式，零成本解决模式可见性问题。

### 背景

用户反馈每次需要手动执行 `cat .devmind/current-mode.txt` 查看当前模式非常不便，特别是在会话过程中频繁切换模式时容易忘记当前状态。

### 方案对比

| 方案 | 优点 | 缺点 | 结论 |
|------|------|------|------|
| Claude Code status line | 实时显示在状态栏 | 需要开发 VSCode 插件，复杂度高 | ❌ 排除 |
| 系统通知 | 模式切换时弹出通知 | 干扰性太强，打断工作流 | ❌ 排除 |
| 文件监控 + 显示 | 自动监控文件变化 | 需要额外进程，资源消耗 | ❌ 排除 |
| 提示词指令 | 零成本，实时更新 | 依赖 AI 执行 | ✅ 采用 |

### 决策

在 CLAUDE.md 模板中添加"回复格式要求"章节：

```markdown
## 回复格式要求

**每次回复结束时**，读取 `.devmind/current-mode.txt` 并在末尾单独一行显示当前模式：

📍DevMind: {模式}
```

### 理由

1. **零成本**：不需要额外开发或进程
2. **实时更新**：每次回复都会读取最新状态
3. **不干扰对话**：显示在末尾，不影响正常内容
4. **可靠性高**：AI 会严格遵循 CLAUDE.md 中的指令

### 影响

- 用户无需手动查询，随时了解当前工作模式
- 提升了 DevMind 的用户体验
- 为未来的状态显示功能（如当前计划、检查点）提供了模式参考

### 相关文件

- `packages/cli/src/templates.ts` (CLAUDE_MD 模板)
- `.claude/CLAUDE.md:69-84` (回复格式要求章节)
