# /dm:auto 设计决策：带门控的自动流水线

> 日期：2026-02-26
> 标签：auto, 自动化, 流水线, 风险门控, slash-command

**摘要**：`/dm:auto` 采用带门控的方案（低风险全自动、高风险暂停确认），复用现有模式标识符而非新增持久模式，以最小实现代价获得最大自动化收益。

## 背景

频繁手动切换 explore → plan → build 模式打断开发节奏，需要一个"一句话触发"的自动流水线。
核心矛盾：完全自动化（无确认）vs 安全性（防止跑偏）。

## 决策

### 决策 1：方案 B（带门控）而非方案 A（完全自动）

**选择**：低风险改动全程自动，高风险改动触发一次确认。

**风险评估指标（全部满足 = 低风险）：**
- 涉及文件 ≤ 5 个
- 不新增 npm/pip/go 依赖
- 不修改 hook 脚本、配置文件 schema
- 不涉及数据库 migration 或破坏性 API 变更

**理由**：大多数日常需求都是低风险的，门控几乎不增加摩擦；
对少数复杂任务，一次确认能有效防止跑偏，收益远大于代价。
完全自动（方案 A）对高风险改动没有任何保护，风险不可接受。

### 决策 2：复用现有模式标识符，不新增 `auto` 模式

**选择**：`/dm:auto` 执行期间，阶段 1-2 写 `explore`，阶段 3-4 写 `build`，不引入新的持久模式值。

**理由**：`auto` 是一个临时流水线，不是持久状态。
新增模式需要修改 Hook 逻辑（pre-tool-use.sh），成本高且容易引入 bug。
复用现有模式，Hook 约束自动生效，一致性有保障。

### 决策 3：纯 slash command 实现，不新增 CLI 子命令

**选择**：只新增 `.claude/commands/dm/auto.md`，不在 CLI 包中添加对应子命令。

**理由**：slash command 已足够，零额外构建成本；
CLI 子命令适合需要脚手架的场景（如 `devmind init`），流水线编排不需要。

## 已知限制

- 风险评估为粗粒度，部分单文件高风险改动可能被低估
- auto 模式 build 阶段暂停后通过 `/dm:build` 续传，无专用 resume 语法
