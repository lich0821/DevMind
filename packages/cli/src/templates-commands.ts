// templates-commands.ts — Slash command templates (part 1: explore/edit/plan/build)

export const CMD_EXPLORE = `---
description: 进入只读分析模式，理解代码架构，定位问题，不修改任何文件
---

进入 **EXPLORE 模式**（只读）。

## 前置操作

\`\`\`sh
echo "explore" > .devmind/current-mode.txt
\`\`\`

## 行为规则

- **禁止**调用 Write / Edit / NotebookEdit 工具（Hook 会自动拦截）
- 可自由读取任何文件
- 加载 \`.devmind/memory/index.md\`，了解项目历史决策背景

## 分析输出格式

完成探索后，输出：

1. **发现摘要**：1-3 句话描述关键发现
2. **相关记忆**：列出 index.md 中与当前问题相关的 Decision/Pattern（如有）
3. **建议下一步**：根据发现推荐切换到哪个模式
   - 问题已定位，改动小 → 建议 \`/dm:edit\`
   - 需要方案规划 → 建议 \`/dm:plan\`
   - 已有明确计划 → 建议 \`/dm:build\`

## 注意

不要在 Explore 模式下给出"修改建议"——探索是为了理解，不是为了行动。
如需修改，明确切换模式后再操作。
`;

export const CMD_EDIT = `---
description: 进入小范围编辑模式，直接实施明确的修改，跨文件改动需确认
---

进入 **EDIT 模式**（小范围编辑）。

## 前置操作

\`\`\`sh
echo "edit" > .devmind/current-mode.txt
\`\`\`

## 行为规则

- 允许修改文件，但**优先最小化改动范围**
- **修改超过 2 个文件前**，必须先输出清单并等待确认，未经确认不得执行：

\`\`\`
即将修改多个文件：
- [文件1]：[修改原因]
- [文件2]：[修改原因]
- [文件3]：[修改原因]

超过 2 个文件，继续？(y/n)
\`\`\`

- 不新增 npm/pip/go 依赖，不做架构级修改
- 每次修改前简要说明：改什么、为什么、预期效果

## 适用场景

- 修复已定位的 bug（先用 \`/dm:explore\` 诊断，再切此模式修复）
- 实施小型功能改动（已知改什么、改哪里）
- 小范围实验性修改

## 完成后

建议使用 \`/dm:remember\` 记录有价值的发现（如果发现了重要规律）。
如果改动方案复杂，建议先切换到 \`/dm:plan\` 制定方案。
`;

export const CMD_PLAN = `---
description: 制定结构化方案，强制检索 Graveyard 防止重蹈覆辙，等待开发者选择后生成 Spec
---

进入 **PLAN 模式**（方案规划）。

## 前置操作

\`\`\`sh
echo "plan" > .devmind/current-mode.txt
\`\`\`

## 执行步骤

### 步骤1：强制检索 Graveyard

读取 \`.devmind/memory/graveyard/\` 下的所有文件。

检查当前提议是否与已否决方案相似（关键词重叠）。

可选：使用 \`devmind check-graveyard "<提议描述>"\` 快速检测。

如发现匹配，**必须**先输出警告：

\`\`\`
⚠️ 发现相似的已否决方案：[方案名]
   否决原因：[原因摘要]
   关键词重叠：[关键词列表]

请选择：
(1) 查看完整否决原因后决定是否继续
(2) 情况不同，当前方案与此无关，继续规划
(3) 确实相似，直接放弃此方向
\`\`\`

等待开发者选择后继续。

### 步骤2：输出结构化方案对比

每个方案使用以下格式：

\`\`\`markdown
## 方案 X：[方案名]

### 确定的部分
- [条目]

### 不确定的部分
- ⚠️ [不确定点]：[说明]

### 风险评估
- 技术风险：低/中/高
- 回滚成本：低/中/高
\`\`\`

### 步骤3：等待开发者选择

输出所有方案后，等待开发者明确选择，不要自行推进。

### 步骤4：生成 Spec 化 current-plan.md

开发者选定方案后，写入 \`.devmind/current-plan.md\`：

\`\`\`markdown
# 计划：[任务名称]

> 选定日期：YYYY-MM-DD  方案：[方案名]

## Spec

### 约束（不可违反，违反时自动暂停）
- [约束条目]

### 预期产出（可验证）
- [ ] [可验证的产出条目]

### 允许修改的文件范围
- [文件或目录]

### 明确排除（修改这些文件时必须暂停确认）
- [文件或目录]

## 执行步骤

1. [步骤]
\`\`\`

## 注意

- 不修改任何业务代码（Hook 强制执行）
- 方案对比要客观，不要偏向复杂方案
`;

export const CMD_BUILD = `---
description: 按确认计划严格执行，支持断点续传，遇计划外分叉自动暂停
---

进入 **BUILD 模式**（Spec 执行）。

## 前置操作

\`\`\`sh
echo "build" > .devmind/current-mode.txt
\`\`\`

## 启动检查

### 1. 检查历史检查点

读取 \`.devmind/session.yaml\`（如果存在）：

如果有 \`status: paused\` 的检查点，**立即告知**开发者：
\`\`\`
上次任务：[计划名]
已完成：[已完成检查点列表]
待续：[暂停检查点] — 原因：[暂停原因]

请选择：
(1) 从断点继续
(2) 重新开始（清除历史检查点）
\`\`\`

### 2. 加载执行约束

读取 \`.devmind/current-plan.md\` 的 Spec 区块。

如果 \`current-plan.md\` 不存在或没有 Spec 区块，停止并提示：
\`\`\`
缺少执行计划。请先使用 /dm:plan 制定方案。
\`\`\`

## 执行规则

1. **严格按照执行步骤推进**，不跳步
2. 每完成一个步骤，向 \`session.yaml\` 追加检查点
3. 遇到计划外文件、依赖或约束冲突时**立即暂停**

## 完成后

输出执行摘要，建议使用 \`/dm:remember\` 沉淀决策。
`;
